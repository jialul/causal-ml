<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Provides various statistical methods for evaluating
    Individualized Treatment Rules under randomized data. The provided
    metrics include Population Average Value (PAV), Population Average
    Prescription Effect (PAPE), Area Under Prescription Effect Curve
    (AUPEC). It also provides the tools to analyze Individualized
    Treatment Rules under budget constraints. Detailed reference in Imai
    and Li (2019) &lt;arXiv:1905.05389&gt;.">
<title>Evaluating Individualized Treatment Rules • evalITR</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Evaluating Individualized Treatment Rules">
<meta property="og:description" content="Provides various statistical methods for evaluating
    Individualized Treatment Rules under randomized data. The provided
    metrics include Population Average Value (PAV), Population Average
    Prescription Effect (PAPE), Area Under Prescription Effect Curve
    (AUPEC). It also provides the tools to analyze Individualized
    Treatment Rules under budget constraints. Detailed reference in Imai
    and Li (2019) &lt;arXiv:1905.05389&gt;.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">evalITR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/install.html">Installation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MichaelLLi/evalITR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><p><img src="reference/figures/README-manual.png" width="100%"></p>
<div class="section level1">
<div class="page-header"><h1 id="evalitr">evalITR<a class="anchor" aria-label="anchor" href="#evalitr"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of evalITR from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"MichaelLLi/evalITR"</span>, ref <span class="op">=</span> <span class="st">"causal-ml"</span><span class="op">)</span></span></code></pre></div>
<p>(Optional) if you have multiple cores, we recommendate using multisession futures and processing in parallel. This would increase computation efficiency and reduce the time to fit the model.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">nworkers</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span><span class="va">nworkers</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-under-sample-splitting">Example under sample splitting<a class="anchor" aria-label="anchor" href="#example-under-sample-splitting"></a>
</h2>
<p>This is an example using the <code>star</code> dataset (for more information about the dataset, please use <code><a href="reference/star.html">?star</a></code>).</p>
<p>We start with a simple example with one outcome variable (writing scores) and one machine learning algorithm (causal forest). Then we move to incoporate multiple outcomes and compare model performances with several machine learning algorithms.</p>
<p>To begin, we load the dataset and specify the outcome variable and covariates to be used in the model. Next, we utilize a random forest algorithm to develop an Individualized Treatment Rule (ITR) for estimating the varied impacts of small class sizes on students’ writing scores. Since the treatment is often costly for most policy programs, we consider a case with 20% budget constraint (<code>budget</code> = 0.2). The model will identify the top 20% of units who benefit from the treatment most and assign them to with the treatment. We train the model through sample splitting, with the <code>split_ratio</code> between the train and test sets determined by the <code>split_ratio</code> argument. Specifically, we allocate 70% of the data to train the model, while the remaining 30% is used as testing data (<code>split_ratio</code> = 0.7).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MichaelLLi/evalITR" class="external-link">evalITR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"data/star.rda"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specifying the outcome</span></span>
<span><span class="va">outcomes</span> <span class="op">&lt;-</span> <span class="st">"g3tlangss"</span></span>
<span></span>
<span><span class="co"># specifying the treatment</span></span>
<span><span class="va">treatment</span> <span class="op">&lt;-</span> <span class="st">"treatment"</span></span>
<span></span>
<span><span class="co"># specifying the data (remove other outcomes)</span></span>
<span><span class="va">star_data</span> <span class="op">&lt;-</span> <span class="va">star</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">g3treadss</span>,<span class="va">g3tmathss</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specifying the formula</span></span>
<span><span class="va">user_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span></span>
<span>  <span class="st">"g3tlangss ~ treatment + gender + race + birthmonth + birthyear + SCHLURBN + GRDRANGE + GKENRMNT + GKFRLNCH + GKBUSED + GKWHITE "</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># estimate ITR </span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/estimate_itr.html">estimate_itr</a></span><span class="op">(</span></span>
<span>               treatment <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>               form <span class="op">=</span> <span class="va">user_formula</span>,</span>
<span>               data <span class="op">=</span> <span class="va">star_data</span>,</span>
<span>               algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"causal_forest"</span><span class="op">)</span>,</span>
<span>               budget <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>               split_ratio <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="co">#&gt; Evaluate ITR under sample splitting ...</span></span>
<span></span>
<span></span>
<span><span class="co"># evaluate ITR </span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/evaluate_itr.html">evaluate_itr</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cannot compute PAPDp</span></span></code></pre></div>
<p>Alternatively, we can train the model with the <code>caret</code> package (for further information about <code>caret</code>, see <a href="http://topepo.github.io/caret/index.html" class="external-link">caret</a>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># alternatively (with caret package)</span></span>
<span></span>
<span><span class="co"># specify the trainControl method</span></span>
<span><span class="va">fitControl</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span><span class="co">## 3-fold CV</span></span>
<span>                           method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>                           number <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                           <span class="co">## repeated 3 times</span></span>
<span>                           repeats <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># specify the tuning grid</span></span>
<span><span class="va">gbmGrid</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>interaction.depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">9</span><span class="op">)</span>, </span>
<span>                        n.trees <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span><span class="op">*</span><span class="fl">50</span>, </span>
<span>                        shrinkage <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                        n.minobsinnode <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># estimate ITR</span></span>
<span><span class="va">fit_caret</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/estimate_itr.html">estimate_itr</a></span><span class="op">(</span></span>
<span>              treatment <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>              form <span class="op">=</span> <span class="va">user_formula</span>,</span>
<span>              trControl <span class="op">=</span> <span class="va">fitControl</span>,</span>
<span>              data <span class="op">=</span> <span class="va">star_data</span>,</span>
<span>              algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gbm"</span><span class="op">)</span>,</span>
<span>              budget <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>              split_ratio <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>              tuneGrid <span class="op">=</span> <span class="va">gbmGrid</span>,</span>
<span>              verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># evaluate ITR</span></span>
<span><span class="va">est_caret</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/evaluate_itr.html">evaluate_itr</a></span><span class="op">(</span><span class="va">fit_caret</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check the final model</span></span>
<span><span class="va">est_caret</span><span class="op">$</span><span class="va">estimates</span><span class="op">$</span><span class="va">models</span><span class="op">$</span><span class="va">gbm</span><span class="op">$</span><span class="va">finalModel</span></span></code></pre></div>
<p>The<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function displays the following summary statistics: (1) population average prescriptive effect <code>PAPE</code>; (2) population average prescriptive effect with a budget constraint <code>PAPEp</code>; (3) population average prescriptive effect difference with a budget constraint <code>PAPDp</code>. This quantity will be computed with more than 2 machine learning algorithms); (4) and area under the prescriptive effect curve <code>AUPEC</code>. For more information about these evaluation metrics, please refer to <a href="https://arxiv.org/abs/1905.05389" class="external-link">Imai and Li (2021)</a>; (5) Grouped Average Treatment Effects <code>GATEs</code>. The details of the methods for this design are given in <a href="https://arxiv.org/abs/2203.14511" class="external-link">Imai and Li (2022)</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summarize estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── PAPE ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      1.4           1.2 causal_forest       1.1    0.27</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── PAPEp ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      1.6           1.3 causal_forest       1.3    0.21</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── PAPDp ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; data frame with 0 columns and 0 rows</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── AUPEC ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      1.8             1 causal_forest       1.8   0.071</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── GATE ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm group statistic p.value  upper lower</span></span>
<span><span class="co">#&gt; 1      -24           107 causal_forest     1     -0.22   0.825 -200.3   153</span></span>
<span><span class="co">#&gt; 2     -231           108 causal_forest     2     -2.14   0.032 -408.5   -54</span></span>
<span><span class="co">#&gt; 3      160           109 causal_forest     3      1.47   0.141  -18.9   340</span></span>
<span><span class="co">#&gt; 4      173           108 causal_forest     4      1.61   0.108   -4.2   351</span></span>
<span><span class="co">#&gt; 5      -69           107 causal_forest     5     -0.64   0.521 -245.2   108</span></span>
<span></span>
<span><span class="co"># similarly for caret</span></span>
<span><span class="co"># summary(est_caret)</span></span></code></pre></div>
<p>We can extract estimates from the <code>est</code> object. The following code shows how to extract the GATE estimates for the writing score with <code>rlasso</code> and <code>lasso</code> algorithms.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot GATE estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span><span class="op">$</span><span class="va">GATE</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">group</span>, y <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>    ymin <span class="op">=</span> <span class="va">lower</span> , ymax <span class="op">=</span> <span class="va">upper</span>, color <span class="op">=</span> <span class="va">algorithm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggdist</span><span class="fu">::</span><span class="fu"><a href="http://mjskay.github.io/ggdist/reference/geom_pointinterval.html" class="external-link">geom_pointinterval</a></span><span class="op">(</span></span>
<span>    width<span class="op">=</span><span class="fl">0.5</span>,    </span>
<span>    position<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    interval_size_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>    fatten_point <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"GATE estimate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"#4e4e4e"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#076f00"</span>, <span class="st">"#0072B2"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="reference/figures/gate.png" width="60%"></p>
<p>We plot the estimated Area Under the Prescriptive Effect Curve for the writing score across a range of budget constraints for causal forest.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the AUPEC </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-sp_plot-1.png" width="60%"></p>
</div>
<div class="section level2">
<h2 id="example-under-cross-validation">Example under cross-validation<a class="anchor" aria-label="anchor" href="#example-under-cross-validation"></a>
</h2>
<p>The package also allows estimate ITR with k-folds cross-validation. Instead of specifying the <code>split_ratio</code> argument, we choose the number of folds (<code>n_folds</code>). The following code presents an example of estimating ITR with 3 folds cross-validation. In practice, we recommend using 10 folds to get a more stable model performance.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimate ITR </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span></span>
<span><span class="va">fit_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/estimate_itr.html">estimate_itr</a></span><span class="op">(</span></span>
<span>               treatment <span class="op">=</span> <span class="va">treatment</span>,</span>
<span>               form <span class="op">=</span> <span class="va">user_formula</span>,</span>
<span>               data <span class="op">=</span> <span class="va">star_data</span>,</span>
<span>               trcontrol <span class="op">=</span> <span class="va">fitControl</span>,</span>
<span>               algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"causal_forest"</span><span class="op">)</span>,</span>
<span>               budget <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>               n_folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Evaluate ITR with cross-validation ...</span></span>
<span></span>
<span><span class="co"># evaluate ITR </span></span>
<span><span class="va">est_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/evaluate_itr.html">evaluate_itr</a></span><span class="op">(</span><span class="va">fit_cv</span><span class="op">)</span></span>
<span><span class="co">#&gt; Cannot compute PAPDp</span></span>
<span></span>
<span><span class="co"># summarize estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_cv</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── PAPE ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     0.49          0.91 causal_forest      0.54    0.59</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── PAPEp ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      2.6          0.76 causal_forest       3.4   6e-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── PAPDp ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; data frame with 0 columns and 0 rows</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── AUPEC ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1      1.2           1.5 causal_forest      0.81    0.42</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── GATE ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm group statistic p.value upper lower</span></span>
<span><span class="co">#&gt; 1      -85            59 causal_forest     1     -1.45    0.15    30  -201</span></span>
<span><span class="co">#&gt; 2       40            59 causal_forest     2      0.68    0.50   157   -76</span></span>
<span><span class="co">#&gt; 3       29            59 causal_forest     3      0.50    0.62   145   -86</span></span>
<span><span class="co">#&gt; 4       13            59 causal_forest     4      0.22    0.82   129  -103</span></span>
<span><span class="co">#&gt; 5       21           102 causal_forest     5      0.20    0.84   220  -179</span></span>
<span></span>
<span><span class="co"># plot the AUPEC </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est_cv</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-cv_estimate-1.png" width="60%"></p>
</div>
<div class="section level2">
<h2 id="example-with-multiple-ml-algorithms">Example with multiple ML algorithms<a class="anchor" aria-label="anchor" href="#example-with-multiple-ml-algorithms"></a>
</h2>
<p>We can estimate ITR with various machine learning algorithms and then compare the performance of each model. The package includes all ML algorithms in the <code>caret</code> package and 2 additional algorithms (<a href="https://grf-labs.github.io/grf/reference/causal_forest.html" class="external-link">causal forest</a> and <a href="https://cran.r-project.org/web/packages/bartCause/index.html" class="external-link">bartCause</a>).</p>
<p>The package also allows estimate heterogeneous treatment effects on the individual and group-level. On the individual-level, the summary statistics and the AUPEC plot show whether assigning individualized treatment rules may outperform complete random experiment. On the group-level, we specify the number of groups through <code>ngates</code> and estimating heterogeneous treatment effects across groups.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify the trainControl method</span></span>
<span><span class="va">fitControl</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span></span>
<span>                           method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>                           number <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                           repeats <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co"># estimate ITR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span></span>
<span><span class="va">fit_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/estimate_itr.html">estimate_itr</a></span><span class="op">(</span></span>
<span>               treatment <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>               form <span class="op">=</span> <span class="va">user_formula</span>,</span>
<span>               data <span class="op">=</span> <span class="va">star_data</span>,</span>
<span>               trControl <span class="op">=</span> <span class="va">fitControl</span>,</span>
<span>               algorithms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                  <span class="st">"causal_forest"</span>, </span>
<span>                  <span class="st">"bartc"</span>,</span>
<span>                  <span class="st">"lasso"</span>, <span class="co"># from caret package</span></span>
<span>                  <span class="st">"rf"</span><span class="op">)</span>, </span>
<span>               budget <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>               n_folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Evaluate ITR with cross-validation ...</span></span>
<span><span class="co">#&gt; fitting treatment model via method 'bart'</span></span>
<span><span class="co">#&gt; fitting response model via method 'bart'</span></span>
<span><span class="co">#&gt; fitting treatment model via method 'bart'</span></span>
<span><span class="co">#&gt; fitting response model via method 'bart'</span></span>
<span><span class="co">#&gt; fitting treatment model via method 'bart'</span></span>
<span><span class="co">#&gt; fitting response model via method 'bart'</span></span>
<span></span>
<span><span class="co"># evaluate ITR</span></span>
<span><span class="va">est_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/evaluate_itr.html">evaluate_itr</a></span><span class="op">(</span><span class="va">fit_cv</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summarize estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">est_cv</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── PAPE ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     0.95          0.82 causal_forest      1.17    0.24</span></span>
<span><span class="co">#&gt; 2    -0.32          0.41         bartc     -0.79    0.43</span></span>
<span><span class="co">#&gt; 3     0.17          1.07         lasso      0.16    0.87</span></span>
<span><span class="co">#&gt; 4     1.27          0.95            rf      1.33    0.18</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── PAPEp ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     2.55          0.65 causal_forest      3.91 9.2e-05</span></span>
<span><span class="co">#&gt; 2     1.45          0.89         bartc      1.63 1.0e-01</span></span>
<span><span class="co">#&gt; 3    -0.21          0.63         lasso     -0.33 7.4e-01</span></span>
<span><span class="co">#&gt; 4     1.69          1.11            rf      1.52 1.3e-01</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── PAPDp ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation             algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     1.11          1.01 causal_forest x bartc      1.09 0.27423</span></span>
<span><span class="co">#&gt; 2     2.76          0.80 causal_forest x lasso      3.46 0.00054</span></span>
<span><span class="co">#&gt; 3     0.87          0.71    causal_forest x rf      1.22 0.22292</span></span>
<span><span class="co">#&gt; 4     1.65          1.02         bartc x lasso      1.62 0.10506</span></span>
<span><span class="co">#&gt; 5    -0.24          1.16            bartc x rf     -0.21 0.83600</span></span>
<span><span class="co">#&gt; 6    -1.89          0.72            lasso x rf     -2.62 0.00892</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── AUPEC ───────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   estimate std.deviation     algorithm statistic p.value</span></span>
<span><span class="co">#&gt; 1     1.43           1.5 causal_forest      0.92    0.36</span></span>
<span><span class="co">#&gt; 2     0.78           1.5         bartc      0.54    0.59</span></span>
<span><span class="co">#&gt; 3     0.18           1.4         lasso      0.13    0.90</span></span>
<span><span class="co">#&gt; 4     1.37           1.6            rf      0.88    0.38</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── GATE ────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;    estimate std.deviation     algorithm group statistic p.value upper lower</span></span>
<span><span class="co">#&gt; 1    -118.1            59 causal_forest     1    -2.013   0.044  -3.1  -233</span></span>
<span><span class="co">#&gt; 2      27.0            59 causal_forest     2     0.454   0.650 143.5   -90</span></span>
<span><span class="co">#&gt; 3      60.9            59 causal_forest     3     1.034   0.301 176.4   -55</span></span>
<span><span class="co">#&gt; 4       7.6            59 causal_forest     4     0.128   0.898 123.7  -109</span></span>
<span><span class="co">#&gt; 5      40.9            99 causal_forest     5     0.411   0.681 235.8  -154</span></span>
<span><span class="co">#&gt; 6      32.2            59         bartc     1     0.542   0.588 148.8   -84</span></span>
<span><span class="co">#&gt; 7    -143.5            59         bartc     2    -2.435   0.015 -28.0  -259</span></span>
<span><span class="co">#&gt; 8      33.2            82         bartc     3     0.406   0.685 193.5  -127</span></span>
<span><span class="co">#&gt; 9      47.8            59         bartc     4     0.809   0.419 163.5   -68</span></span>
<span><span class="co">#&gt; 10     48.5            92         bartc     5     0.529   0.597 228.3  -131</span></span>
<span><span class="co">#&gt; 11    -14.4            94         lasso     1    -0.154   0.878 169.2  -198</span></span>
<span><span class="co">#&gt; 12    -94.5            90         lasso     2    -1.051   0.293  81.8  -271</span></span>
<span><span class="co">#&gt; 13     87.9            99         lasso     3     0.886   0.376 282.4  -107</span></span>
<span><span class="co">#&gt; 14     12.6            59         lasso     4     0.214   0.830 127.8  -103</span></span>
<span><span class="co">#&gt; 15     26.6            59         lasso     5     0.451   0.652 142.4   -89</span></span>
<span><span class="co">#&gt; 16    -37.4            59            rf     1    -0.638   0.523  77.5  -152</span></span>
<span><span class="co">#&gt; 17     10.6            59            rf     2     0.180   0.857 126.5  -105</span></span>
<span><span class="co">#&gt; 18    -17.6            59            rf     3    -0.299   0.765  97.7  -133</span></span>
<span><span class="co">#&gt; 19     66.5            86            rf     4     0.770   0.441 235.9  -103</span></span>
<span><span class="co">#&gt; 20     -3.9            60            rf     5    -0.066   0.948 113.0  -121</span></span></code></pre></div>
<p>We plot the estimated Area Under the Prescriptive Effect Curve for the writing score across different ML algorithms.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the AUPEC with different ML algorithms</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">est_cv</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-multiple_plot-1.png" style="display: block; margin: auto;"></p>
<p>For caret models, we can extract the training model and check the model performance.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract the caret model</span></span>
<span><span class="va">fit</span><span class="op">$</span><span class="va">estimates</span><span class="op">$</span><span class="va">models</span><span class="op">$</span><span class="va">rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="reference/figures/rf.png" width="60%"></p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=evalITR" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/MichaelLLi/evalITR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/MichaelLLi/evalITR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;=2)</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing evalITR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Michael Lingzhi Li <br><small class="roles"> Author, maintainer </small>  </li>
<li>Kosuke Imai <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Lingzhi Li, Kosuke Imai.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
